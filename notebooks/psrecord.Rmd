---
title: "Memory tracking"
author: "Harly Durbin"
output:
  html_document:
    toc: true
    toc_depth: 2
    df_print: paged
    code_folding: show
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(readr)
library(dplyr)
library(ggplot2)
library(purrr)
library(tidyr)
library(lubridate)

source(here::here("source_functions/psrecord_summary.R"))
```

# `ancient_preprocess`

## `trimBam`

```{r}
usage_summary(process = "ancient_preprocess", keyword = "trimBam")
```

```{r}
usage_facets(process = "ancient_preprocess", keyword = "trimBam")
```

## `index_bam`

```{r}
usage_summary(process = "ancient_preprocess", keyword = "index_bam")
```

```{r}
usage_facets(process = "ancient_preprocess", keyword = "index_bam")
```

## `target_creator`

```{r}
usage_summary(process = "ancient_preprocess", keyword = "target_creator")
```

```{r}
usage_facets(process = "ancient_preprocess", keyword = "target_creator")
```

## `indel_realigner`

```{r}
usage_summary(process = "ancient_preprocess", keyword = "indel_realigner")
```

```{r}
usage_facets(process = "ancient_preprocess", keyword = "indel_realigner")
```

## `merge_realigned`

```{r}
usage_summary(process = "ancient_preprocess", keyword = "merge_realigned")
```

```{r}
usage_facets(process = "ancient_preprocess", keyword = "merge_realigned")
```



# `joint_genotyping`

* ~ 2,900 multi-breed and multi-species *Bos* samples

## `combine_gvcfs`

* Combining 33 cohort-GVCFs of ~ 90 samples each into chromosome-level GVCFs using `GATK CombineGVCFs`
* For each chromosome, provided 4 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "combine_gvcfs") 
```

## `genotype_gvcfs`

* Chromosome-by-chromosome joint genotyping with `GATK GenotypeGVCFs`
* For each chromosome, provided 28 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "genotype_gvcfs") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "genotype_gvcfs")
```

## `select_variants`

* Removing indels & multiallelic SNPs using `GATK SelectVariants`
* For each chromosome, provided 8 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "select_variants") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "select_variants")
```

## `info_filtration`

* Site-level filtering using `GATK VariantFiltration`
* For each chromosome, provided 8 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "info_filtration") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "info_filtration")
```

## `remove_failed`

* Removing variants that didn't pass filtering using `GATK SelectVariants`
* For each chromosome, provided 8 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "remove_failed") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "remove_failed")
```

## `format_filtration`

* Genotype-level filtering using `bcftools filter`
* For each chromosome, provided 6 threads

```{r}
usage_summary(process = "joint_genotyping", keyword = "format_filtration") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "format_filtration")
```

## `index_filtered`

```{r}
usage_summary(process = "joint_genotyping", keyword = "index_filtered") 
```

```{r}
usage_facets(process = "joint_genotyping", keyword = "index_filtered
")
```

## `concat`

* Concatenating chromosome-level files into one whole-genome file using `bcftools concat`

```{r,eval=FALSE}
usage_summary(process = "joint_genotyping", keyword = "concat") 
```

```{r, eval=FALSE}
usage_facets(process = "joint_genotyping", keyword = "concat")
```

## `index_concat`

* Index concatenated whole-genome file using `bcftools index`

```{r,eval=FALSE}
usage_summary(process = "joint_genotyping", keyword = "index_concat") 
```

```{r, eval=FALSE}
usage_facets(process = "joint_genotyping", keyword = "index_concat")
```

## `collect_metrics`

* Run `Picard CollectVariantCallingMetrics` on concatenated whole-genome file

```{r,eval=FALSE}
usage_summary(process = "joint_genotyping", keyword = "collect_metrics") 
```

```{r, eval=FALSE}
usage_facets(process = "joint_genotyping", keyword = "collect_metrics")
```

# `find_dups`

## `extract_850K`

* Extract 850K marker set from sorted whole-genome using `bcftools view`

```{r,eval=FALSE}
usage_summary(process = "joint_genotyping", keyword = "extract_850K") 
```

```{r, eval=FALSE}
usage_facets(process = "joint_genotyping", keyword = "extract_850K")
```

## `index_850K`

```{r,eval=FALSE}
usage_summary(process = "joint_genotyping", keyword = "index_850K") 
```

```{r, eval=FALSE}
usage_facets(process = "joint_genotyping", keyword = "index_850K")
```
