---
title: "PCA"
author: "Harly Durbin"
output:
  html_document:
    df_print: paged
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(readr)
library(magrittr)
library(purrr)
library(dplyr)
library(stringr)
library(ggplot2)

source(here::here("source_functions/plot_pca.R"))
```

# Notes & questions

* [Eigensoft population lists vs. projection](https://compvar-workshop.readthedocs.io/en/latest/contents/02_pca/pca.html#population-lists-vs-projection)

# Setup

```{r}
sample_metadata <- 
  read_csv(here::here("data/derived_data/metadata/bovine_demo.sample_metadata.csv")) %>% 
  mutate(international_id = if_else(international_id == "CPC98_Bprimigenius_EnglandDerbyshire_5936", "ancient_derbyshire", international_id))
```

```{r}
read_table2(here::here("data/derived_data/plink_qc/thin_variants/full.superthin/merge_thinned.full.superthin.fam"), col_names = FALSE) %>% 
  select(-X6) %>% 
  mutate(pop = if_else(X1 %in% c("A2494_Yenisei_River", "ancient_derbyshire"), "ancient", "modern"))
```


# Results

## `full`

```{r}
plot_pca(dataset_thinning = "projectfull.superthin", pc1 = 1, pc2 = 2, color_var = species, shape_var = continent)
```


## `20cattle`


```{r}
plot_pca(dataset_thinning = "project20cattle.superthin", pc1 = 2, pc2 = 3, color_var = continent, shape_var = species)
```

```{r}
read_vec(dataset_thinning = "project20cattle.superthin") %>% 
  View()
```

## `20all`

```{r}
plot_pca(dataset_thinning = "project20all.superthin", pc1 = 1, pc2 = 2, color_var = species)
```

## `allbanteng`

```{r}
plot_pca(dataset_thinning = "allbanteng.superthin", pc1 = 1, pc2 = 2, color_var = population)
```

## `allgaurgayal`

```{r}
plot_pca(dataset_thinning = "allgaurgayal.superthin", pc1 = 1, pc2 = 2, color_var = population)
```

## `allyak`

* Probably 3 mislabeled "yak jinchuan"

```{r}
plot_pca(dataset_thinning = "allyak.superthin", pc1 = 3, pc2 = 4, color_var = population)
```

# Commentary