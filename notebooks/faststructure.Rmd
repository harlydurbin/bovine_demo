---
title: "fastStructure"
author: "Harly Durbin"
output:
  html_document:
    df_print: paged
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(readr)
library(dplyr)
library(stringr)
library(magrittr)
library(rlang)
library(purrr)
library(ggplot2)
library(tidylog)

source(here::here("source_functions/structure_functions.R"))
```

# Notes & questions


## Dataset key

* Which samples

```{r}
tibble::tribble(
  ~ Name, ~ Description, ~ `k ran`,
  "full", "All species. All available samples.", "1-20",
  "20all", "All species. Up to 20 (ranked by coverage) samples per population label.", "1-20",
  "20cattle", "Bos taurus, B.indicus, B. primigenius, composite. Up to 20 (ranked by coverage) samples per population label.", "1-20",
  "5cattle", "Bos taurus, B.indicus, B. primigenius, composite. Up to 5 (ranked by coverage) samples per population label.", "1-20",
  "5taurine", "Bos taurus, B. primigenius. Up to 5 (ranked by coverage) samples per population label.", "1-20",
  "allyak", "B. grunniens and B. mutus. All available samples.", "1-10",
  "allgayalgaur", "B. frontalis and B. gaurus. All available samples.", "1-10",
  "allbanteng", "B. javanicus. All available samples.", "1-8"
)
```

* Thinning parameter

```{r}
tibble::tribble(
  ~ Name, ~ Description,
  "superthin", "Randomly retain 0.001% of SNPs from each chromosome",
  "onepercent", "Randomly retain 0.01% of SNPs from each chromosome"
)
```

# Setup

```{r}
sample_metadata <- 
  read_csv(here::here("data/derived_data/metadata/bovine_demo.sample_metadata.csv")) %>% 
  mutate(international_id = if_else(international_id == "CPC98_Bprimigenius_EnglandDerbyshire_5936", "ancient_derbyshire", international_id))
```


# `allyak`

```{r}

read_fs(dataset_thinning = "allyak.superthin", k = 4) %>%
  gg_fs(wrap_var = "population")

```

# `allbanteng`

Model complexity that maximizes marginal likelihood = 1
Model components used to explain structure in data = 2

```{r}
read_fs(dataset_thinning = "allbanteng.superthin", k = 2) %>%
  gg_fs(wrap_var = "population")
```

# `allgaurgayal`

Model complexity that maximizes marginal likelihood = 5
Model components used to explain structure in data = 1

```{r}
read_fs(dataset_thinning = "allgaurgayal.superthin", k = 2) %>%
  gg_fs(wrap_var = "population")
```


# Commentary