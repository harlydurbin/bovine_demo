---
title: "fastStructure"
author: "Harly Durbin"
output:
  html_document:
    df_print: paged
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(readr)
library(dplyr)
library(stringr)
library(magrittr)
library(purrr)
library(tidyr)
library(tidylog)
```

# Notes & questions

* In order to [install via conda](https://bioconda.github.io/recipes/faststructure/README.html), need a Python 2.7 environment, which means you can't run Snakemake

---

## Dataset key

* Which samples

```{r}
tibble::tribble(
  ~ Name, ~ Description,
  "all", "All 2,362 samples",
  "20cattle", "Bos taurus, B.indicus, composite, and ancient samples only. Up to 20 (ranked by coverage) samples per population label"
)
```

* Thinning parameter

```{r}
tibble::tribble(
  ~ Name, ~ Description,
  "superthin", "Randomly retain 0.001% of SNPs from each chromosome"
)
```

# Setup

```{r}
sample_metadata <- read_csv(here::here("data/derived_data/metadata/bovine_demo.sample_metadata.csv"))
```

## Dataset creation

### `20cattle`

```{r}
sample_metadata %>% 
  filter(species %in% c("bos primigenius", "bos taurus", "composite", "bos indicus")) %>% 
  group_by(population) %>% 
  top_n(20, avg_coverage) %>% 
  mutate(fid = international_id) %>% 
  select(international_id, fid) %>% 
  write_tsv(here::here("data/derived_data/faststructure/thin_variants/keeplist.20cattle.txt"), col_names = FALSE)
```

